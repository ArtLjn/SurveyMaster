
---

## ğŸ—„ æ•°æ®å­˜å‚¨è®¾è®¡

### 1. MySQLï¼ˆå…³ç³»å‹ï¼Œå­˜æ ¸å¿ƒç»“æ„åŒ–æ•°æ®ï¼‰

ä¸»è¦å­˜ **ç”¨æˆ·ã€é—®å·åŸºæœ¬ä¿¡æ¯ã€é€‰é¡¹é…ç½®**ã€‚

#### `user` ç”¨æˆ·è¡¨

```sql
CREATE TABLE user (
    id BIGINT PRIMARY KEY AUTO_INCREMENT,
    username VARCHAR(50) UNIQUE NOT NULL,
    password VARCHAR(100) NOT NULL,
    email VARCHAR(100),
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);
```

#### `survey` é—®å·è¡¨

```sql
CREATE TABLE survey (
    id BIGINT PRIMARY KEY AUTO_INCREMENT,
    user_id BIGINT NOT NULL, -- åˆ›å»ºè€…
    title VARCHAR(200) NOT NULL,
    description TEXT,
    status TINYINT DEFAULT 0, -- 0=è‰ç¨¿,1=å‘å¸ƒ,2=å…³é—­
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    FOREIGN KEY (user_id) REFERENCES user(id)
);
```

#### `question` é—®é¢˜è¡¨

```sql
CREATE TABLE question (
    id BIGINT PRIMARY KEY AUTO_INCREMENT,
    survey_id BIGINT NOT NULL,
    type VARCHAR(20) NOT NULL, -- single, multiple, text
    content TEXT NOT NULL,
    FOREIGN KEY (survey_id) REFERENCES survey(id)
);
```

#### `option_table` é€‰é¡¹è¡¨

```sql
CREATE TABLE `option_table` (
    id BIGINT PRIMARY KEY AUTO_INCREMENT,
    question_id BIGINT NOT NULL,
    content VARCHAR(200) NOT NULL,
    FOREIGN KEY (question_id) REFERENCES question(id)
);
```

---

### 2. MongoDBï¼ˆéå…³ç³»å‹ï¼Œå­˜ç”¨æˆ·å›ç­”ï¼‰

å­˜å‚¨çµæ´»çš„ JSON ç»“æ„ç­”æ¡ˆã€‚

#### `answers` é›†åˆ

```json
{
  "survey_id": 1,
  "user_id": 101,
  "submitted_at": "2025-09-10T10:00:00Z",
  "answers": [
    {
      "question_id": 10,
      "answer": ["é€‰é¡¹A"] 
    },
    {
      "question_id": 11,
      "answer": ["é€‰é¡¹B", "é€‰é¡¹C"]
    },
    {
      "question_id": 12,
      "answer": "è¿™æ˜¯æ–‡æœ¬å›ç­”"
    }
  ]
}
```

---

### 3. Redisï¼ˆç¼“å­˜ & å®æ—¶ç»Ÿè®¡ï¼‰

ç”¨æ¥åŠ é€ŸæŠ•ç¥¨/é—®å·ç»“æœç»Ÿè®¡ã€‚

* **key è®¾è®¡ï¼š**

    * `survey:count:{surveyId}` â†’ Hashï¼Œå­˜æ¯ä¸ªé—®é¢˜çš„é€‰é¡¹è®¡æ•°
    * `survey:hot` â†’ ZSetï¼ŒæŒ‰å¡«å†™äººæ•°æ’åçš„çƒ­é—¨é—®å·
    * `user:session:{token}` â†’ Stringï¼Œå­˜ç™»å½•ä¼šè¯

ç¤ºä¾‹ï¼š

```bash
HINCRBY survey:count:1:question:10 option:3 1   # ç»™é—®é¢˜10çš„é€‰é¡¹3åŠ 1ç¥¨
ZINCRBY survey:hot 1 1                           # é—®å·ID=1 çƒ­åº¦+1
```

---

### 4. RabbitMQï¼ˆå¼‚æ­¥å¤„ç†ï¼‰

* ç”¨æˆ·æäº¤å›ç­”åï¼Œç«‹å³å†™å…¥ MongoDBï¼Œå†æŠŠæ¶ˆæ¯å‘åˆ° RabbitMQã€‚
* æ¶ˆè´¹è€…æ¥æ”¶æ¶ˆæ¯åï¼š

    1. æ›´æ–° Redis å®æ—¶è®¡æ•°
    2. å¼‚æ­¥è½åœ°ç»Ÿè®¡ç»“æœåˆ° MySQLï¼ˆé˜²æ­¢æ•°æ®ä¸¢å¤±ï¼‰

---

### 5. Elasticsearchï¼ˆæœç´¢ï¼‰

* åŒæ­¥ `survey` å’Œ `question` æ•°æ®åˆ° ES
* æ”¯æŒï¼š

    * æŒ‰æ ‡é¢˜/æè¿°å…³é”®å­—æœç´¢é—®å·
    * æŒ‰åˆ›å»ºè€…æœç´¢
    * æŒ‰æ ‡ç­¾ï¼ˆå¯æ‰©å±•ï¼‰æœç´¢

---

è¿™æ ·ä¸€æ¥ï¼š

* **MySQL** â†’ ç”¨æˆ· & é—®å·ç»“æ„
* **MongoDB** â†’ ç”¨æˆ·å›ç­”
* **Redis** â†’ å®æ—¶ç»Ÿè®¡ & çƒ­åº¦
* **RabbitMQ** â†’ å¼‚æ­¥å¤„ç† & è§£è€¦
* **Elasticsearch** â†’ æœç´¢

---

